---
title: "Innovation Landscapes:  An Analysis of National Science Foundation Research Grants from 1999-2016"
author: "Sahar Alhassan, Kaitlin Lynes, Deepa Mehta, Ilya Perepelitsa"
date: "December 21, 2015"
output: pdf_document
---
\section{Introduction}

Innovation is often considered to be considered an engine for development. Governments typically support innovation by funding research and development for universities, corporations, and other institutions. (Etzkowitz and Leydesdorff 2000) Recently, the White House approved a bipartisan budget agreement which will allocate even more funding over the next years in order to maintain the United States' leadership in innovation. (Donavan 2015) One of the few agencies that this bipartisan agreement will support is the National Science Foundation (NSF). 

NSF is an independent, federal grantmaking agency that awards nearly one fourth of all federal grants in the United States, nearly 11,000 new grants per year, and has a current annual budget of $7.3 billion (NSF 2015). A majority of these grants support critical research in science and technology. In order to get a sense of how innovation research, as procured by the NSF, is distributed, one can visit the NSF website to locate some summary statistics about grant awards. However, the NSF website provides only basic information about the number of grants awarded and grant allocations by states and institutions. For any serious researcher who is interested in understanding the landscape of federal funding of innovation in the United States, one is met with an aggregate dataset that numbers in the millions of grants awarded since NSF's founding in 1950. 

Given the sheer number of grants and the number of variables that denote grant type, this report began with a desire to develop an analytical methodology to understand the distribution of NSF grants and recognize any emergent patterns within these numbers. As such, this report studies NSF grants from the fiscal years 1999 to 2016 and aims to understand the distribution of NSF grants during this period. By developing a subset of the aggregate NSF data, we have been able to study the distribution of grant duration by type of grant (new grants, continuing grants, or revised grants), grants by recipient type (universities, private instititutions or corporations, etc.), by state, and by types of funded research. 

The broader aim of this exercise in big data analytics is to be able to apply quantitative methods to larger datasets, acquire subsets, and devise collated dataframes that can then be useful in identifying distributional attributes. The findings in this report and this dataframe may be useful to scholars, grantseeking organizations and individuals, as well as state agencies and private institutions to better understanding the landscape of scientific research funding in the United States. 

\section{Methodology}

As a starting point, our dataset is comprised of queries obtained from the publicly available https://www.usaspending.gov. Using multiple queries on the followig page https://www.usaspending.gov/Pages/TextView.aspx?data=HomeAwardTypeFunding , the range of fiscal years 1999-2016 was obtained. The variables that were selected for the working dataframe are as follows: 

#####Grant Periods
* fiscal_year - Budget year
* starting_date - Start date of awarded research project 
* ending_date - End date of awarded research project
* obligation_action_date - Start date of grant award obligation 

#####Grant Amounts and Grant Type
* fed_funding_amount - Dollar amount of grant 
This is the total amount awarded for a particular grant.

* action_type - Type of Grant Award  
This variable tells us whether this is a new grant, a continuing grant, or revised grant. A new grant refers to a new award which typically entail a "specific level of support for a specified period of time", while continuing grants provide specified support for an initial period of time, "with a statement of intent to provide additional support of the project for additional periods, provided funds are available", while revised grants refer to existing NSF grants that have been amended with new terms (NSF 2015).

#####Grant Recipient Information 
* recipient_name - Recipient Name  
This variable denotes the name of the recipient, usually a university or organization. 

* recipient_type -Type of Recipient  
This variable allows us to identify whether the recipeint organization is a higher education institution, corporation, or non-profit, among other categories.

* cfda_program_title - Field of research
This refers to the research discipline of a grant. 

#####Grant Recipient Location 
* recipient_city_name - Recipient's City  
* principal_place_state - Recipient location state  
* principal_place_state_code - Recipient location state code
These variable allows us to identify the location of the recipient.  

The following modifications were conducted to the existing variables:
1. conversion of non-numeric variable into categorical variables 
2. dates were transformed to be treated as dates by R
3. dublicates of variable values were merged to be treated as identcal values 
4. cfda_programm_title values were replaced by more concise Continue, New and Revision 

The following variables were added as new columns
* res_duration - This is the duration of research obtained by calculating the difference between the ending and starting dates of research. Such values were divided by 30 to obtain duration in months.

* costmon - The variable fed_funding_amount was divided by res_duration to establish the common base for comparing amounts alocated to different recipients.

* monstar, mondec - Month of research start and obligation action date respectively.

* logcost - Log-transormed costmon calculated for plotting these data.

The resulting dataset consists of 410,292 observations of 17 variables. Various subsets were created to calculate cumulative amounts granted to states, programs and by months. Subsets of top recipient states was also created for similar purposes. 


\section{General observations}

Initially, we mapped the total number of awarded grants (410,292) from 1999 to 2016 based on the _Obligation Action Date_ and _Awarded Grant Dollars per month_ divided by _Action Type_. Here, we observed a concentration of continuing grants using a log transformation to identify any relationships between the type of grant over this 17 year period. We also observed a steady number of all grants to be somewhere between $0 to $500,000, with some continuing awards reaching $1,000,000 and some new awards reaching $1,500,000. We also observed revised grants in the negatives. We attribute these negative numbers of nominal grant dollars (mostly in revision grants) to the fact that these grants often seek to make up for cost overruns. \vspace{20 mm}

```{r, fig.width=12, fig.height=4, echo=FALSE, warning=FALSE, error=FALSE}
load("NSF.RData")

newdata1 <- schoolsall[which(schoolsall$obligation_action_date < '2015-01-01' & schoolsall$obligation_action_date > '2012-01-01'), ]
newdata5 <- schoolsall[which(schoolsall$starting_date < '2015-01-01' & schoolsall$starting_date > '1999-01-01'), ]

bigstates <- schoolsall[which(schoolsall$principal_place_state_code == "CA" | schoolsall$principal_place_state_code == "CO" | schoolsall$principal_place_state_code == "DC" | schoolsall$principal_place_state_code == "IL"| schoolsall$principal_place_state_code == "MA"| schoolsall$principal_place_state_code == "NY"| schoolsall$principal_place_state_code == "PA"| schoolsall$principal_place_state_code == "TX"), ]

sumbystate <- aggregate(fed_funding_amount ~ principal_place_state_code + fiscal_year, schoolsall, sum)
sumbyprog <- aggregate(fed_funding_amount ~ cfda_program_title + fiscal_year, schoolsall, sum)
sumbymon <- aggregate(fed_funding_amount ~ mondec + fiscal_year, schoolsall, sum)
sumbyrect <- aggregate(fed_funding_amount ~ recipient_type + fiscal_year, schoolsall, sum)

library(ggplot2)

ggplot(schoolsall,aes(x=obligation_action_date, y = logcost)) + geom_point(aes(color= action_type ))  + ggtitle("log-transformed Grant Dollars per month of research, historical 1999-2016")+ labs(x="Obligation action date",y="log(Grant Dollars per month of research)") 

```

```{r, fig.width=12, fig.height=4, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(schoolsall,aes(x=obligation_action_date, y = fed_funding_amount/100000)) + geom_point(aes(color= action_type )) + ggtitle("Nominal Grant Dollars per month of research / $100K, historical 1999-2016")+ labs(x="Obligation action date",y="Dollars per month of research / $100K") 

```
We then categorically analyzed the difference between continuing, new, and revised grants over the 17 year period using a log transformation of their allocated amounts. Here, we continued to see the steady flow of continuing grants, with some outliers of low grant awards. We also observed a more narrow, but steady concentration, of new grants, with even more outliers of lower grant awards. With this log transformation, we observed a large gap in the amount of revised grants. \vspace{20 mm}

```{r, fig.width=12, fig.height=4, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(newdata1, aes(y=logcost, x=obligation_action_date)) + geom_point(aes(color = action_type)) + facet_wrap(~action_type) + ggtitle("Seasonal cyclicality 2012-2015") + labs(x="Obligation action date, 2012-2015",y="log(Grant Dollars per month of research)") + 
  theme(
  axis.text.x = element_blank(),
  axis.text.y = element_blank(),
  axis.ticks = element_blank())
 
```
About this plot\vspace{20 mm}

```{r, fig.width=12, fig.height=3, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(newdata5, aes(y=logcost, x=obligation_action_date)) + geom_point(aes(color = action_type))+  facet_wrap(~action_type) + ggtitle("A gap in revisions") + labs(x="Obligation action date, 1999-2015",y="log$") + 
  theme(
  axis.text.x = element_blank(),
  axis.text.y = element_blank(),
  axis.ticks = element_blank())
 
```
About this plot\vspace{10 mm}

```{r, fig.width=12, fig.height=2, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(newdata5, aes(y=fed_funding_amount/100000, x=obligation_action_date)) + geom_point(aes(color = action_type))+  facet_wrap(~action_type) + ggtitle("Gap explained by log conversion") + labs(y="Nominal M/$100K",x=element_blank()) + 
  theme(
  axis.text.x = element_blank(),
  axis.text.y = element_blank(),
  axis.ticks = element_blank())
 
```
About this plot\vspace{20 mm}

```{r, fig.width=4, fig.height=2, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(schoolsall, aes(x=log(costmon), fill=action_type)) + geom_density(alpha = 0.6) + ggtitle("Cost differences between action types") + labs(y="Density",x="log(Grant $/Month)")
```

About this plot\vspace{20 mm}
```{r, fig.width=12, fig.height=5, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(schoolsall, aes(y=res_duration, x=log(costmon))) + geom_point(aes(color = action_type))+ facet_wrap(~action_type)+ ggtitle("Difference in cost and duration")+ labs(y="Duration in Months",x="log(Grant $/Month)")
```

```{r, fig.width=15, fig.height=6, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(schoolsall, aes(x=monstar, y=log(costmon), fill=action_type)) + geom_boxplot()+ facet_wrap(~action_type) + ggtitle("Monthly Outliers") + theme(axis.text.x = element_text(angle=45)) + labs(y="log(Grant $/Month)",x=element_blank())
```

\section{Fields of research}
```{r, fig.width=15, fig.height=6, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(sumbyprog, aes(x=fed_funding_amount, y=reorder(cfda_program_title, fed_funding_amount), fill = fiscal_year)) + ggtitle("Most financed fields of research") + labs(y=element_blank(),x="Cumulative annual allocation") + geom_point(size=3) + theme(axis.text.x = element_text(angle=60, hjust = 1), panel.grid.major.y = element_blank(), panel.grid.minor.y = element_blank(), panel.grid.major.x = element_line(color="grey60", linetype='dashed'))
```

\section{States}


```{r, fig.width=15, fig.height=10, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(sumbystate, aes(x=fed_funding_amount, y=reorder(principal_place_state_code, fed_funding_amount), fill = fiscal_year)) + ggtitle("Most financed states") + labs(y=element_blank(),x="Cumulative annual allocation") +
  geom_point(size=3) + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle=60, hjust = 1),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color="grey60", linetype='dashed'))
```


```{r, fig.width=15, fig.height=6, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(bigstates, aes(x=principal_place_state_code, y=log(costmon), fill = action_type)) + geom_boxplot() + facet_wrap(~action_type) + guides(colour = guide_legend(override.aes = list(size=12)))+ ggtitle("Most financed states - outliers") + labs(x=element_blank(),y="log(Grant $/Month)")
```


\section{Months}
```{r, fig.width=15, fig.height=6, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(sumbymon, aes(x=fed_funding_amount, y=mondec, fill = fiscal_year)) + ggtitle("Highest cumulative months values") +
  geom_point(size=3) + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle=60, hjust = 1),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color="grey60", linetype='dashed'))

```

```{r, fig.width=15, fig.height=6, echo=FALSE, warning=FALSE, error=FALSE}

ggplot(schoolsall, aes(x=log(costmon), fill=mondec)) + geom_density(alpha = 0.1) + facet_wrap(~action_type) +geom_vline(aes(xintercept=mean(logcost), na.rm=T), color="red", linetype="dashed", size=1) + ggtitle("Monthly variations") + labs(x="log(Grant $/Month)",y="Density")
```


```{r, fig.width=15, fig.height=6, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(schoolsall, aes(x=mondec, y=log(costmon), fill=mondec)) + geom_boxplot() + facet_wrap(~action_type)+ ggtitle("Fall variance") + labs(x=element_blank(),y="log(Grant $/Month)")+ theme(axis.text.x = element_text(angle=45))

```
\section{Recipient}



```{r, fig.width=15, fig.height=6, echo=FALSE, warning=FALSE, error=FALSE}
ggplot(sumbyrect, aes(x=fed_funding_amount, y=reorder(recipient_type, fed_funding_amount), fill = fiscal_year)) + ggtitle("Concentrations by types of recipients - cumulative annual") + 
  geom_point(size=3) + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle=60, hjust = 1),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color="grey60", linetype='dashed'))

```

\section{Discussion}



\section{Bibliography}


